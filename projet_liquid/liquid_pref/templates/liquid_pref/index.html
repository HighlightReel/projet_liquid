<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://cdn.jsdelivr.net/npm/handsontable@9.0/dist/handsontable.full.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@9.0/dist/handsontable.full.min.css" /> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
        <script type="module">

            const container_shares = document.getElementById('shares_input');
            const container_options = document.getElementById('options_input');
            const container_shares_prices = document.getElementById('shares_price');
            const container_options_prices = document.getElementById('options_price');
            const save = document.querySelector('#save');

            var cap_table;
            var liquid_pref;

            const data_shares = [
            ['', 'Common shares', 'A shares', 'B shares', 'C shares'],
            ['Investor 1', 0, 0, 0, 0],
            ['Investor 2', 0, 0, 0, 0],
            ['Investor 3', 0, 0, 0, 0],
            ['Investor 4', 0, 0, 0, 0],
            ['Investor 5', 0, 0, 0, 0]
            ];

            const data_options = [
            ['', 'Options A', 'Options B', 'Options C'],
            ['Employee 1', 0, 0, 0],
            ['Employee 2', 0, 0, 0],
            ['Employee 3', 0, 0, 0],
            ['Employee 4', 0, 0, 0],
            ['Employee 5', 0, 0, 0]
            ];

            const data_shares_prices = [
            ['', 'Nominal', 'A shares', 'B shares', 'C shares'],
            ['Share price', 0, 0, 0, 0]
            ];

            const data_options_prices = [
            ['', 'Options A', 'Options B', 'Options C'],
            ['Option price', 0, 0, 0]
            ];

            const hot_shares = new Handsontable(container_shares, {
            data: JSON.parse(JSON.stringify(data_shares)),
            startRows: 5,
            startCols: 4,
            height: 'auto',
            width: 'auto',
            minSpareRows: 0,
            minSpareCols: 0,
            licenseKey: 'non-commercial-and-evaluation',
            contextMenu: 'true',
            });

            const hot_options = new Handsontable(container_options, {
            data: JSON.parse(JSON.stringify(data_options)),
            startRows: 5,
            startCols: 3,
            height: 'auto',
            width: 'auto',
            minSpareRows: 0,
            minSpareCols: 0,
            licenseKey: 'non-commercial-and-evaluation',
            contextMenu: 'true',
            });

            const hot_shares_price = new Handsontable(container_shares_prices, {
            data: JSON.parse(JSON.stringify(data_shares_prices)),
            startRows: 1,
            startCols: 4,
            height: 'auto',
            width: 'auto',
            minSpareRows: 0,
            minSpareCols: 0,
            licenseKey: 'non-commercial-and-evaluation',
            contextMenu: 'true',
            });

            const hot_options_price = new Handsontable(container_options_prices, {
            data: JSON.parse(JSON.stringify(data_options_prices)),
            startRows: 1,
            startCols: 3,
            height: 'auto',
            width: 'auto',
            minSpareRows: 0,
            minSpareCols: 0,
            licenseKey: 'non-commercial-and-evaluation',
            contextMenu: 'true',
            });

            function ajax(url, method, params, callback) {
                let obj;
                try {
                    obj = new XMLHttpRequest();
                } catch (e) {
                    try {
                    obj = new ActiveXObject('Msxml2.XMLHTTP');
                    } catch (e) {
                    try {
                        obj = new ActiveXObject('Microsoft.XMLHTTP');
                    } catch (e) {
                        alert('Your browser does not support Ajax.');
                        return false;
                    }
                    }
                }
                obj.onreadystatechange = () => {
                    if (obj.readyState == 4) {
                    callback(obj);
                    }
                };
                obj.open(method, url, true);
                obj.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                obj.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                obj.send(params);
                return obj;
                }

            Handsontable.dom.addEvent(save, 'click', () => {
            // save all cell's data
            ajax('{% url 'index' %}', 'POST', JSON.stringify({data_shares: hot_shares.getData(), data_options: hot_options.getData(), data_shares_prices: hot_shares_price.getData(), data_options_prices: hot_options_price.getData()}), res => {
                cap_table = res.response;
                document.querySelector("#cap_table").innerHTML = cap_table;
            });
            });

                        
            $('#form_django').submit(function(e){
                $.post('{% url 'generate' %}', $(this).serialize(), function(data){ 
                $('.message').html(data);
                // of course you can do something more fancy with your respone
                });
                e.preventDefault();
            });

            function display() {
                ajax('{% url 'display' %}', 'GET', JSON.stringify({mockup: 0}), res => {
                liquid_pref = res.response;
                document.querySelector("#liquid_pref").innerHTML = liquid_pref;
            });
            }

            document.addEventListener('DOMContentLoaded', function() {
                document.querySelector("#display").onclick = display;
            } );
            </script>
            <style>
                .flex-container {
                    display: grid;
                    padding: 40px;
                    grid-column-gap: 20px;
                    grid-row-gap: 20px;
                    grid-template-columns: 50% 50%;
                }

                .flex-container > div {
                    padding: 10px;
                    text-align: center;
                    border-radius: 10px;
                }

                #form_django {
                    padding: 10px;
                    margin: 40px;
                    border-radius: 10px;
                    border: dashed 2px black;
                }

                #form_django  > div{
                    padding: 10px;
                    text-align: center;
                }

                .shares {
                    border: solid 2px rgb(12, 182, 205);
                }

                .shares > h2 {
                    background-color: rgb(12, 182, 205);
                }

                .options {
                    border: solid 2px rgb(0, 160, 75);
                }

                .options > h2 {
                    background-color: rgb(0, 160, 75);
                }

                .handsontable {
                    font-family: sans-serif;
                }

                button {
                    padding: 20px;
                    margin: 20px;
                }

                h1 {
                    padding: 20px;
                    margin: 20px;
                    background-color: rgb(0, 42, 80);
                    color: white;
                    font-size: 20px;
                }

                h2 {
                    padding: 20px;
                    margin: 20px;
                    background-color: rgb(12, 182, 205);
                    font-size: 15px;
                    color: white;
                }


                .table {
                    padding: 20px;
                    margin: 20px;                   
                }

                .table td {
                    text-align: center;   
                    }

                .table th {
                    text-align: center;   
                    }

                .buttons {
                    text-align: center;
                }

                #Omnes {
                    text-align: center;
                    padding: 20px;
                }

                img {
                    width:400px;
                    height: auto;
                }

                footer {
                    text-align: center;
                    font-style: italic;
                    font-size: 15px;
                    padding: 20px;
                }

            </style>
        <title>Liquid pref</title>
    </head>
    <body>

        <div id="Omnes">
            <img src="https://www.omnescapital.com/wp-content/uploads/2021/02/omnes.jpg" class="img-fluid" alt="...">
        </div>

        <h1>1) Cap table</h1>

        <div class="flex-container">

            <div class="shares">
                <h2>Shares input</h2>
                <div id="shares_input"></div>
            </div>
            <div class="options">
                <h2>Options input</h2>
                <div id="options_input"></div>
            </div>

            <div class="shares">
                <h2>Shares Price</h2>
                <div id="shares_price"></div>
            </div>
            <div class="options">
                <h2>Options Price</h2>
                <div id="options_price"></div>
            </div>
        </div>        

        <div class="buttons">
            <button id="save" class="btn btn-primary">Display cap table</button>
            <button id="download_cp" class="btn btn-success">Download cap table</button>
        </div>

        <div id="cap_table"></div>


        <h1>2) Liquid pref</h1>
        <form action="" method="POST" id="form_django">
            {{ form }}
            <div>
            <input type="submit" value="Save parameters" class="btn btn-warning">
            </div>
        </form>

        <div class="message"></div>

        <div class="buttons">
            <button id="display" class="btn btn-primary">Display liquid pref</button>
            <button id="download_lp" class="btn btn-success">Download liquid pref</button>
        </div>

        <div id="liquid_pref"></div>

    </body>
    <footer>
        <p>Programmed by Hugo Hubert - 2021</p>
      </footer> 
</html>